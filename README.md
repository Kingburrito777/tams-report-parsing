# TAMS Report Parser

## Overview

The TAMS Report Parser is a Python-based tool designed to parse ASCII text reports generated by the Total Automotive Management System (TAMS), widely used by NAPA Auto Parts stores across the United States. The ASCII tables in these reports are not suitable for creating visualizations, comparing data, or performing dynamic analyses. This parser addresses these limitations by converting the raw ASCII data into structured JSON format, enabling easier data manipulation, analysis, and visualization.

Currently, the parser supports the following TAMS reports, which are among the most commonly used:

- **RPT001**: Employee Sales Report
- **RPT002**: Transaction Register
- **RPT003**: Transaction Activity by Quarter Hour
- **RPT004**: Sales Journal
- **RPT083**: Inventory Effectiveness

The parser processes these reports from compressed (`.z`) or uncompressed (`.PF`) files, organizes the data by date, and outputs a structured JSON file (`dump.json`) for further use.

## Features

- **Report Parsing**: Extracts data from fixed-width ASCII tables in TAMS reports and converts them into structured JSON.
- **Supported Reports**:
  - **RPT001**: Employee Sales Report with employee and sales representative metrics, including daily, monthly, and yearly sales, profit margins, and invoice details.
  - **RPT002**: Transaction Register with detailed transaction data, including financial metrics and memo sections.
  - **RPT003**: Transaction Activity by Quarter Hour, breaking down transactions by 15-minute intervals with cash/charge sales and invoice counts.
  - **RPT004**: Sales Journal with categorized sales performance metrics (Merchandise, Labor, Net Sales, etc.) and comparisons across periods.
  - **RPT083**: Inventory Effectiveness with in-store vs. non-store inventory counts, lost sales, and effectiveness ratings.
- **File Handling**: Supports both compressed (`.z`) and uncompressed (`.PF`) report files, with automatic decompression for `.z` files.
- **Structured Output**: Produces a JSON file (`dump.json`) organized by date and report type, making it easy to query and analyze.
- **Error Handling**: Robust parsing with error handling for malformed lines and missing data, ensuring reliable processing.

## Installation

### Prerequisites

- Python 3.8 or higher
- Required Python packages:
  - `gzip` (standard library)
  - `json` (standard library)

### Setup

1. Clone the repository or copy the project files to your local machine:

   ```bash
   git clone <repository-url>
   cd tams-report-parser
   ```
2. Install dependencies (if any additional packages are added in the future):

   ```bash
   pip install -r requirements.txt
   ```

   Note: Currently, no external dependencies are required beyond the Python standard library.
3. Ensure your TAMS report files are organized in the expected directory structure (see **Directory Structure** below).

## Usage

1. **Prepare Report Files**:

   - Place your TAMS report files in a directory structure where each subdirectory is named by date (e.g., `20140512`).
   - Supported file formats: `.PF` (uncompressed) or `.PF.z` (compressed).
   - Example directory structure:

     ```
     reports/
     ├── 20140512
     │   ├── RPT001_20140514181224.PF.z
     │   ├── RPT002_20140514181224.PF.z
     │   ├── RPT003_20140514181224.PF.z
     │   ├── RPT004_20140514181225.PF.z
     │   ├── RPT083_20140514182541.PF.z
     │   └── ...
     ├── 20140513
     │   ├── RPT001_20140515181224.PF.z
     │   └── ...
     ```

2. **Run the Parser**:

   - Execute the main script to parse all reports in the `reports/` directory:

     ```bash
     python main.py
     ```
   - The script will:
     - Iterate through each date directory.
     - Decompress `.z` files as needed.
     - Parse supported reports (RPT001, RPT002, RPT003, RPT004, RPT083).
     - Save the parsed data to `dump.json`.

3. **Output**:

   - The parsed data is saved in `dump.json` with the following structure:

     ```json
     {
       "20141125": {
         "RPT001": { ... },
         "RPT002": { ... },
         "RPT003": { ... },
         "RPT004": { ... },
         "RPT083": { ... }
       },
       "20141126": {
         "RPT001": { ... },
         "RPT002": { ... },
         "RPT003": { ... },
         "RPT004": { ... },
         "RPT083": { ... }
       },
       ...
     }
     ```
   - Each report's data is structured according to its specific parser (see **Report Details**).

## Report Details

### RPT001: Employee Sales Report

- **Description**: Tracks individual employee and sales representative performance.
- **Data Extracted**:
  - Metadata: Report date, store ID, store name, accounting day.
  - Employee metrics: Daily, monthly, and yearly sales, gross profit, and profit percentages.
  - Invoice details: Transaction counts, voids, returns, and return values.
  - Comparative data: Current period vs. last year.
  - Store totals and memo delivery sales.
- **Output Structure**:

  ```json
  {
    "metadata": { ... },
    "employees": { ... },
    "salesreps": { ... },
    "totals": { ... },
    "memo_delivery_sales": { ... }
  }
  ```

### RPT002: Transaction Register

- **Description**: Details individual transactions with financial metrics.
- **Data Extracted**:
  - Metadata: Report date, store ID, store name, accounting day.
  - Transactions: Type, invoice number, customer, employee, salesrep, cashier, financials (net sales, cost, profit).
  - Summary: Sales totals, rebates, codes legend, transaction counts.
- **Output Structure**:

  ```json
  {
    "metadata": { ... },
    "transactions": [ ... ],
    "summary": { ... }
  }
  ```

### RPT003: Transaction Activity by Quarter Hour

- **Description**: Breaks down transaction activity by 15-minute intervals.
- **Data Extracted**:
  - Metadata: Report date, store ID, store name, accounting day.
  - Time periods: Cash/charge sales, invoice counts, and percentages for today and month-to-date.
  - Totals: Aggregated metrics for today and month-to-date.
- **Output Structure**:

  ```json
  {
    "metadata": { ... },
    "time_periods": { ... },
    "totals": { ... }
  }
  ```

### RPT004: Sales Journal

- **Description**: Summarizes sales performance across categories.
- **Data Extracted**:
  - Metadata: Report date, store ID, store name, accounting day.
  - Categories: Merchandise Sales, Labor Sales, Net Sales, etc., with subcategories (e.g., revenue, cost, profit).
  - Metrics: Today, month-to-date, year-to-date, and last year comparisons.
- **Output Structure**:

  ```json
  {
    "metadata": { ... },
    "categories": { ... }
  }
  ```

### RPT083: Inventory Effectiveness

- **Description**: Analyzes in-store vs. non-store inventory and lost sales.
- **Data Extracted**:
  - Metadata: Report date, store ID, store name, accounting day.
  - Inventory: In-store and non-store item counts, merchandise totals, lost sales.
  - Ratings: Effectiveness percentages for today, month-to-date, year-to-date, and last year.
- **Output Structure**:

  ```json
  {
    "metadata": { ... },
    "inventory": { ... },
    "ratings": { ... }
  }
  ```

## Directory Structure

The parser expects report files to be organized as follows:

```
tams-report-parser/
├── main.py
├── report_parser.py
├── reports/
│   ├── 20140512/
│   │   ├── RPT001_20140514181224.PF.z
│   │   ├── RPT002_20140514181224.PF.z
│   │   └── ...
│   ├── 20140513/
│   │   ├── RPT001_20140515181224.PF.z
│   │   └── ...
├── dump.json
└── README.md
```

## Example Data - RPT001
```
12/06/2023 06:13 PM                          E M P L O Y E E   S A L E S   R E P O R T                                      (RPT001)
900002424 - NAPA AUTO PARTS FORTUNA                      Accounting Day - 5                                                   Page 1
                                                                                                                                   
       ------------Today---------- -----------------MTD----------------- -------------YTD------------- ----------Last Dec-----------
          Net      Gross              Net       Gross                       Net       Gross               Net       Gross           
 Emp     Sales    Profit     GP%     Sales      Profit     GP%    % Chg    Sales      Profit     GP%     Sales      Profit     GP%  
------ --------- --------- ------- ---------- ---------- ------- ------- ---------- ---------- ------- ---------- ---------- -------
*Employee                                                                                                                          
  21        0.00      0.00    0.00       0.00       0.00    0.00 -100.00    1284.28     443.00   34.49     931.04     342.58   36.80
  63        0.00      0.00    0.00       0.00       0.00    0.00 -100.00   -1154.55    -414.46   35.90   -2164.00    -424.70   19.63
  88     2213.48    726.13   32.80   10445.04    3037.61   29.08  -24.64  489057.56  155323.48   31.76   13860.55    4016.27   28.98
------ --------- --------- ------- ---------- ---------- ------- ------- ---------- ---------- ------- ---------- ---------- -------
Total    4749.95   1498.84   31.56   20068.33    6037.59   30.09  -72.62 1244039.94  403027.88   32.40   73284.78   23921.69   32.64
                                                                                                                                   
*Salesrep                                                                                                                          
  0      1368.53    299.19   21.86    6561.31    1957.21   29.83  -72.29  474281.00  145446.97   30.67   23676.41    7550.08   31.89
  1      1052.30    437.80   41.60    4113.85    1675.42   40.73  -81.49  285957.91  109598.83   38.33   22225.78    8389.41   37.75
  3         0.00      0.00    0.00       0.00       0.00    0.00 -100.00    1248.77     484.13   38.77      51.61      22.28   43.17
------ --------- --------- ------- ---------- ---------- ------- ------- ---------- ---------- ------- ---------- ---------- -------
Total    4749.95   1498.84   31.56   20068.33    6037.59   30.09  -72.62 1244039.94  403027.88   32.40   73284.78   23921.69   32.64
                                                                                                                                   
Memo of Delivery Sales                                                                                                             
                                                                                                                                   
       ------------Today---------- -----------------MTD-----------------                                                            
          Net      Gross              Net       Gross                                                                               
         Sales    Profit     GP%     Sales      Profit     GP%                                                                      
       --------- --------- ------- ---------- ---------- -------                                                                    
          873.22    207.46   23.76    3162.57     691.66   21.87                                                                    
```

## Limitations

- **Supported Reports**: Currently limited to RPT001, RPT002, RPT003, RPT004, and RPT083. Other reports (e.g., RPT005, RPT006) have placeholder parsers that need implementation.
- **Fixed-Width Parsing**: Relies on fixed-width column parsing, which may require adjustments if report formats change.
- **Error Handling**: While robust, some malformed reports may require manual preprocessing.
- **Performance**: Processing large numbers of reports may be slow due to file I/O and decompression.

## Future Improvements

- **Additional Report Support**: Implement parsers for remaining TAMS reports (e.g., RPT005, RPT006, RPT013, etc.).
- **Dynamic Parsing**: Add support for dynamic column detection to handle varying report formats.
- **Performance Optimization**: Implement parallel processing for large report sets.
- **Visualization Integration**: Add scripts to generate visualizations from the parsed JSON data.
- **Error Logging**: Enhance logging for better debugging and error tracking.

## Contributing

Contributions are welcome! To contribute:

1. Fork the repository.
2. Create a feature branch (`git checkout -b feature/new-parser`).
3. Commit your changes (`git commit -m "Add parser for RPT005"`).
4. Push to the branch (`git push origin feature/new-parser`).
5. Open a pull request.

Please include tests and documentation updates with your changes.

## License

This project is licensed under the MIT License. See the `LICENSE` file for details.

## Contact

For questions or support, please contact the project maintainer at \[liamlarsen12@gmail.com\] or open an issue on the repository.
